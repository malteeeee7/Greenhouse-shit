<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Benutzerhandbuch - Smart Greenhouse</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .manual-card {
            background-color: white;
            border-radius: 0.75rem;
            border: 1px solid #e5e7eb;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05);
            padding: 1.5rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .manual-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        h2 { font-size: 2.25rem; font-weight: 800; color: #111827; margin-bottom: 1rem; }
        h3 { font-size: 1.25rem; font-weight: 700; color: #1f2937; }
        h4 { font-size: 1.125rem; font-weight: 700; color: #1f2937; }
        .gemini-button {
            background: linear-gradient(45deg, #4ECDC4, #45B7D1);
            color: white;
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .gemini-button:hover { transform: translateY(-2px); box-shadow: 0 7px 10px rgba(0,0,0,0.15); }
        .gemini-button:disabled { background: #9ca3af; cursor: not-allowed; transform: translateY(0); box-shadow: none; }
        .loader { border: 4px solid #f3f4f6; border-top: 4px solid #4ECDC4; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        code { background-color: #e5e7eb; padding: 0.2rem 0.4rem; border-radius: 0.25rem; font-family: monospace; color: #be123c; font-size: 0.875rem; }
        pre code { display: block; white-space: pre-wrap; word-break: break-all; }
        details > summary { cursor: pointer; font-size: 1.125rem; font-weight: 600; }
        .arch-arrow {
            position: relative;
            flex-grow: 1;
            background: #d1d5db; /* gray-300 */
            height: 2px;
        }
        .arch-arrow::after {
            content: '';
            position: absolute;
            right: -1px;
            top: -4px;
            width: 0;
            height: 0;
            border-top: 5px solid transparent;
            border-bottom: 5px solid transparent;
            border-left: 8px solid #d1d5db; /* gray-300 */
        }
    </style>
</head>
<body>
    <div class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center my-12">
            <div class="text-6xl mb-4">üçì</div>
            <h1 class="text-4xl sm:text-5xl font-extrabold text-[#FF6B6B]">Smart Greenhouse Handbuch</h1>
            <p class="mt-4 text-lg text-gray-600">Ihr digitaler Leitfaden f√ºr den vollautomatischen Erdbeeranbau</p>
        </header>

        <main class="space-y-16">
            
            <section>
                <h2 class="text-center">Kapitel 1: Willkommen an Bord!</h2>
                <p class="text-center text-gray-700 max-w-3xl mx-auto mt-4">Dieses Handbuch macht Sie mit allen Funktionen der Steuerungsoberfl√§che (GUI) vertraut, damit Sie das System optimal f√ºr Ihre Erdbeerzucht nutzen k√∂nnen.</p>
                <div class="manual-card mt-8">
                    <h3 class="flex items-center gap-3 text-[#45B7D1]"><div class="text-3xl">üñ•Ô∏è</div><span>Die Benutzeroberfl√§che im √úberblick</span></h3>
                    <ol class="list-decimal list-inside space-y-2 mt-4 text-gray-700 pl-4">
                        <li><strong>Statusleiste:</strong> Zeigt ganz oben den Verbindungsstatus.</li>
                        <li><strong>Sensor-Dashboard:</strong> Eine Live-Anzeige aller wichtigen Messwerte.</li>
                        <li><strong>Aktor-Steuerung:</strong> Ihr Schaltzentrum f√ºr alle Ger√§te.</li>
                        <li><strong>Globale Einstellungen:</strong> Das Gehirn des Automatik-Modus.</li>
                    </ol>
                </div>
            </section>

            <section>
                <h2 class="text-center">Kapitel 2: Die Sensoren verstehen</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-8">
                    <div class="manual-card"><h3 class="flex items-center gap-3 text-[#FF6B6B]"><div class="text-2xl">üå°Ô∏è</div><span>Temperatur & Luftfeuchte</span></h3><p class="mt-2 text-gray-600">Ein <strong>DHT22</strong> Sensor misst diese beiden Werte. Sie sind der Motor des Pflanzenwachstums und entscheidend zur Vermeidung von Pilzkrankheiten. <strong>Reaktion:</strong> L√ºfter & Fenster.</p></div>
                    <div class="manual-card"><h3 class="flex items-center gap-3 text-green-500"><div class="text-2xl">üåø</div><span>Bodenfeuchte</span></h3><p class="mt-2 text-gray-600">Drei <strong>HW-390</strong> Sensoren messen die Feuchtigkeit an verschiedenen Stellen. Dies ist der direkteste Indikator f√ºr den Wasserbedarf. <strong>Reaktion:</strong> Pumpe.</p></div>
                    <div class="manual-card"><h3 class="flex items-center gap-3 text-[#FED766]"><div class="text-2xl">‚òÄÔ∏è</div><span>Lichtst√§rke</span></h3><p class="mt-2 text-gray-600">Ein Lichtsensor misst die Helligkeit. Licht ist die Energiequelle der Pflanze f√ºr die Photosynthese. <strong>Reaktion:</strong> Lampen (im Outdoor-Modus).</p></div>
                    <div class="manual-card"><h3 class="flex items-center gap-3 text-purple-500"><div class="text-2xl">üòé</div><span>UV-Index</span></h3><p class="mt-2 text-gray-600">Ein <strong>UV Sensor v1.1</strong> misst die UV-Strahlung. Dient Ihnen als Indikator f√ºr Sonnenbrand-Stress der Pflanzen. <strong>Reaktion:</strong> Keine (nur zur Information).</p></div>
                    <div class="manual-card col-span-1 md:col-span-2 lg:grid-cols-3"><h3 class="flex items-center gap-3 text-blue-500"><div class="text-2xl">üî¨</div><span>pH-Wert (Manuell)</span></h3><p class="mt-2 text-gray-600">Ein <strong>P5310 A pH-Sensor</strong> liegt zur manuellen Kontrolle bereit. Der pH-Wert ist entscheidend f√ºr die N√§hrstoffaufnahme der Pflanze. Optimal f√ºr Erdbeeren ist ein Wert zwischen 5.8 und 6.5. Dieser Wert ist aktuell <strong>nicht</strong> in die Automatik eingebunden und muss von Hand abgelesen werden.</p></div>
                </div>
            </section>
            
            <section>
                <h2 class="text-center">Kapitel 3: Das Gew√§chshaus steuern</h2>
                <div class="manual-card mt-8">
                    <h3 class="flex items-center gap-3 text-[#45B7D1]"><div class="text-3xl">üïπÔ∏è</div><span>Grundprinzip: AUTO vs. MANUAL</span></h3>
                    <div class="flex flex-col md:flex-row gap-6 mt-4">
                        <div class="flex-1 p-6 rounded-lg bg-blue-50 border-2 border-blue-200"><h4 class="font-bold text-blue-800 text-xl">ü§ñ AUTO-Modus</h4><p class="text-blue-700 mt-2">Die intelligente Automatik steuert alles f√ºr Sie.</p></div>
                        <div class="flex-1 p-6 rounded-lg bg-yellow-50 border-2 border-yellow-300"><h4 class="font-bold text-yellow-800 text-xl"> MANUAL-Modus</h4><p class="text-yellow-700 mt-2">Sie haben die volle Kontrolle √ºber den EIN/AUS-Knopf.</p></div>
                    </div>
                </div>
            </section>

            <section>
                <h2 class="text-center">Kapitel 4: Die Automatik meistern</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mt-8">
                    <div class="manual-card">
                         <h3 class="flex items-center gap-3 text-[#45B7D1]"><div class="text-3xl">üå±</div><span>Einstellung 1: Wachstumsphase</span></h3>
                        <p class="mt-2 text-gray-600">W√§hlen Sie hier die aktuelle Phase Ihrer Erdbeeren, um die Zielwerte f√ºr Temperatur und Luftfeuchtigkeit anzupassen.</p>
                        <div class="chart-container relative w-full h-80 mt-6"><canvas id="growthPhaseChart"></canvas></div>
                    </div>
                    <div class="manual-card">
                         <h3 class="flex items-center gap-3 text-[#45B7D1]"><div class="text-3xl">üí°</div><span>Einstellung 2: Licht-Modus</span></h3>
                         <p class="mt-2 text-gray-600">Sagen Sie dem System, wo das Gew√§chshaus steht. Davon h√§ngt die Lampensteuerung ab.</p>
                        <div class="space-y-4 mt-6">
                            <div class="p-4 rounded-lg bg-gray-100 border"><h4 class="font-bold text-lg">Indoor (Werkstatt)</h4><p class="text-sm text-gray-600 mt-1">Die Lampen sind die Hauptlichtquelle (06-20 Uhr).</p></div>
                            <div class="p-4 rounded-lg bg-gray-100 border"><h4 class="font-bold text-lg">Outdoor (Feuertreppe)</h4><p class="text-sm text-gray-600 mt-1">Die Lampen unterst√ºtzen nur bei starker Bew√∂lkung.</p></div>
                        </div>
                    </div>
                </div>
            </section>

            <section><h2 class="text-center">Kapitel 5: Tipps f√ºr die Rekordernte</h2><div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8"><div class="manual-card"><h3 class="flex items-center gap-3 text-yellow-500"><div class="text-2xl">üêù</div><span>Best√§ubung</span></h3><p class="mt-2 text-gray-600">In der Bl√ºtephase die Bl√ºten sanft mit einem weichen Pinsel best√§uben oder die Pflanze leicht sch√ºtteln. In einem geschlossenen Raum √ºberlebenswichtig f√ºr die Fruchtbildung!</p></div><div class="manual-card"><h3 class="flex items-center gap-3 text-green-500"><div class="text-2xl">üåø</div><span>N√§hrstoffe</span></h3><p class="mt-2 text-gray-600">Unterst√ºtzen Sie Ihre Pflanzen! Besonders in der Fruchtphase hilft ein kaliumbetonter D√ºnger (z.B. Beeren- oder Tomatend√ºnger), um s√º√üere und gr√∂√üere Fr√ºchte zu erhalten.</p></div></div></section>
            <section><h2 class="text-center">Kapitel 6: Wartung & Sicherheit</h2><div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8"><div class="manual-card border-l-4 border-red-500"><h3 class="flex items-center gap-3 text-red-600"><div class="text-2xl">‚ö°</div><span>Sicherheit Zuerst</span></h3><p class="mt-2 text-gray-600"><strong>Vorsicht: Wasser und Strom!</strong> Stellen Sie sicher, dass alle elektrischen Komponenten (Netzteile, Steckdosen) absolut trocken und vor Spritzwasser gesch√ºtzt sind.</p></div><div class="manual-card"><h3 class="flex items-center gap-3"><div class="text-2xl">üîß</div><span>Regelm√§√üige Checks</span></h3><ul class="list-disc list-inside space-y-2 mt-2 text-gray-600"><li><strong>Wasserstand pr√ºfen:</strong> F√ºllen Sie den Wasserkanister regelm√§√üig auf.</li><li><strong>Sensoren reinigen:</strong> Befreien Sie die Bodenfeuchtesensoren gelegentlich von Erdresten.</li><li><strong>Schl√§uche kontrollieren:</strong> Achten Sie darauf, dass der Pumpenschlauch keine Knicke hat.</li></ul></div></div></section>
            <section><h2 class="text-center">Kapitel 7: KI-Gartenexperte ‚ú®</h2><div class="manual-card mt-8"><h3 class="flex items-center gap-3 text-[#45B7D1]"><div class="text-3xl">üßë‚Äçüåæ</div><span>Fragen Sie den Experten</span></h3><div class="mt-4"><label for="plant-question" class="font-semibold text-gray-700">Ihre Frage:</label><div class="flex flex-col sm:flex-row gap-2 mt-2"><input type="text" id="plant-question" placeholder="z.B. Wie z√ºchte ich Auberginen?" class="flex-grow p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent"><button id="ask-button" class="gemini-button">Frage stellen</button></div></div><div id="chat-container" class="mt-6 hidden"><div class="flex items-center gap-3 mb-2"><h4 class="font-bold text-lg text-gray-700">Antwort des Experten</h4><div id="chat-loader" class="loader hidden"></div></div><div id="chat-result" class="p-4 bg-blue-50 border border-blue-200 rounded-lg text-blue-800 space-y-4"></div></div></div></section>
            <section><h2 class="text-center">Kapitel 8: Fehlerbehebung</h2><div class="space-y-4 mt-8"><details class="manual-card"><summary class="font-semibold cursor-pointer">Ein Sensor zeigt nur "--" an.</summary><p class="mt-2 text-gray-600">Das deutet auf ein Verbindungsproblem hin. √úberpr√ºfen Sie, ob das entsprechende Kabel am Sensor und am Arduino fest sitzt.</p></details><details class="manual-card"><summary class="font-semibold cursor-pointer">Die Pumpe l√§uft, aber es kommt kein Wasser.</summary><p class="mt-2 text-gray-600">Pr√ºfen Sie zuerst den Wasserstand im Kanister. Kontrollieren Sie danach den Schlauch auf Knicke und Verstopfungen.</p></details><details class="manual-card"><summary class="font-semibold cursor-pointer">Das Fenster √∂ffnet/schlie√üt sich nicht richtig.</summary><p class="mt-2 text-gray-600">Pr√ºfen Sie die Mechanik auf Blockaden. Ggf. muss die Laufzeit des Motors im Arduino-Code angepasst werden.</p></details></div></section>

            <!-- ANHANG -->
            <section class="mt-20 pt-10 border-t-4 border-dashed border-gray-200">
                <h2 class="text-center text-3xl text-gray-700">Anhang f√ºr Entwickler & Bastler</h2>
                <div class="manual-card mt-8">
                    <h3 class="flex items-center gap-3 text-[#45B7D1]"><div class="text-3xl">üèõÔ∏è</div><span>A: Design-Philosophie & Architektur</span></h3>
                    <p class="mt-4 text-gray-600">Das System basiert auf einer klaren Arbeitsteilung:</p>
                    <ul class="list-disc list-inside space-y-2 mt-4 text-gray-700 pl-4">
                        <li><strong>Raspberry Pi (Das Gehirn):</strong> Verantwortlich f√ºr die Benutzeroberfl√§che (GUI), Datenvisualisierung, KI-Anbindung und das Senden von Befehlen.</li>
                        <li><strong>Arduino (Das Nervensystem):</strong> F√ºhrt Befehle aus, liest Sensoren in Echtzeit und schaltet die Aktoren. L√§uft autonom und stabil.</li>
                    </ul>
                    <div class="mt-6 p-4 border rounded-lg bg-gray-50">
                        <h4 class="font-bold text-center mb-4">Visuelle Systemarchitektur</h4>
                        <div class="flex flex-col md:flex-row items-center justify-center gap-4 md:gap-8 text-center text-sm">
                            <div class="flex flex-col items-center">
                                <div class="text-4xl">üë§</div>
                                <div class="font-bold">Benutzer</div>
                                <div class="w-px h-4 bg-gray-400"></div>
                                <div class="p-3 bg-purple-100 rounded-lg shadow-sm border"><h4 class="font-bold">GUI (Raspberry Pi 5)</h4><p>Python / PyQt5</p></div>
                            </div>
                            <div class="flex items-center w-full md:w-auto"><div class="arch-arrow"></div><span class="mx-2 text-xs text-gray-500 whitespace-nowrap">JSON via USB</span><div class="arch-arrow"></div></div>
                            <div class="p-3 bg-teal-100 rounded-lg shadow-sm border"><h4 class="font-bold">Logik (Arduino Mega)</h4><p>.ino Sketch</p></div>
                            <div class="flex items-center w-full md:w-auto"><div class="arch-arrow"></div><span class="mx-2 text-xs text-gray-500 whitespace-nowrap">I/O Signale</span><div class="arch-arrow"></div></div>
                            <div class="flex flex-col gap-4"><div class="p-3 bg-yellow-100 rounded-lg shadow-sm border"><h4 class="font-bold">Sensoren</h4><p>DHT22, HW-390 etc.</p></div><div class="p-3 bg-red-100 rounded-lg shadow-sm border"><h4 class="font-bold">Aktoren</h4><p>Pumpe, L√ºfter etc.</p></div></div>
                        </div>
                    </div>
                </div>

                <div class="manual-card">
                    <h3 class="flex items-center gap-3 text-[#45B7D1]"><div class="text-3xl">‚öôÔ∏è</div><span>B: Hardware-Spezifikationen</span></h3>
                     <ul class="list-disc list-inside space-y-4 text-gray-700 pl-4 mt-4">
                        <li><strong>Steuerungszentrale:</strong> Raspberry Pi 5 & Arduino Mega</li>
                        <li><strong>Sensorik:</strong> 1x DHT22, 3x HW-390, 1x UV Sensor v1.1, 1x P5310 A (manuell)</li>
                        <li><strong>Aktorik:</strong> 2x be quiet! Pure Wings 2 120mm, 1x Comet Ocean Plus, 2x PARUS Growlight Cultura 18W, 1x AIRPAX 9904 120 52607 12DC, 1x TRU COMPONENTS 8er Relaisboard</li>
                    </ul>
                </div>

                <div class="manual-card">
                    <h3 class="flex items-center gap-3 text-[#45B7D1]"><div class="text-3xl">üîå</div><span>C: Aktor-Spannungsversorgung</span></h3>
                     <div class="space-y-6 mt-4">
                        <div><h4 class="font-bold">L√ºfter:</h4><p class="text-sm text-gray-600">12V DC. Empfehlung: Betrieb mit <strong>5-7V</strong> √ºber einen Step-Down-Converter f√ºr eine sanfte Brise.</p></div><hr>
                        <div><h4 class="font-bold">Pumpe:</h4><p class="text-sm text-gray-600">12V DC. Ben√∂tigt ein starkes, separates <strong>12V Netzteil (min. 7A)</strong>.</p></div><hr>
                        <div><h4 class="font-bold">Lampen:</h4><p class="text-sm text-gray-600">230V AC. Das Relais schaltet die Steckdosenspannung f√ºr die originalen Netzteile.</p></div><hr>
                        <div><h4 class="font-bold">Fenstermotor:</h4><p class="text-sm text-gray-600">12V DC. Kann √ºber ein separates <strong>12V Netzteil (min. 1A)</strong> versorgt werden.</p></div>
                     </div>
                </div>
                
                 <div class="manual-card">
                    <h3 class="flex items-center gap-3 text-[#45B7D1]"><div class="text-3xl">üöÄ</div><span>D: Erweiterungsideen f√ºr die Zukunft</span></h3>
                    <ul class="list-disc list-inside space-y-2 mt-4 text-gray-600 pl-4">
                        <li><strong>N√§hrstoffpumpe:</strong> Integrieren Sie eine zweite, kleinere Pumpe, um automatisch Fl√ºssigd√ºnger zum Wasser hinzuzuf√ºgen.</li>
                        <li><strong>Kamera-Modul:</strong> F√ºgen Sie eine Kamera am Raspberry Pi hinzu, um das Pflanzenwachstum per Livestream zu beobachten oder t√§gliche Zeitraffer-Aufnahmen zu erstellen.</li>
                        <li><strong>F√ºllstandssensor:</strong> Erweitern Sie den Arduino um einen Ultraschall- oder Schwimmsensor, um den Wasserstand im Tank zu messen und eine Warnung in der GUI anzuzeigen.</li>
                        <li><strong>Daten-Logging:</strong> Speichern Sie die Sensordaten in einer Datei oder Datenbank auf dem Raspberry Pi, um Langzeitanalysen durchf√ºhren zu k√∂nnen.</li>
                    </ul>
                </div>

                <div class="manual-card">
                     <h3 class="flex items-center gap-3 text-[#45B7D1]"><div class="text-3xl">‚úèÔ∏è</div><span>E: Code-Referenz</span></h3>
                    <div class="sticky top-2 z-10 p-2 bg-white/80 backdrop-blur-sm rounded-lg shadow my-6">
                         <input type="text" id="commandSearch" placeholder="üîç Suchen Sie nach einem Befehl oder Aktor (z.B. Pumpe, GUI)..." class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent">
                    </div>
                    <div class="space-y-8">
                        <details open class="border-t pt-4"><summary class="text-xl font-bold">Arduino Code-Referenz (.ino)</summary><div id="arduino-commands" class="mt-4 space-y-4"><div class="command-card p-4 border rounded-lg"><h3 class="font-bold">#define PIN_NAME</h3><p class="text-sm text-gray-600">Definiert einen Pin. Dies ist der Ort, an dem Sie die physische Verkabelung im Code abbilden.</p><pre><code class="language-cpp">#define PUMP_PIN 6</code></pre></div><div class="command-card p-4 border rounded-lg"><h3 class="font-bold">const int VARIABLE</h3><p class="text-sm text-gray-600">Deklariert eine feste Konfigurationsvariable. Hier stellen Sie Schwellenwerte ein.</p><pre><code class="language-cpp">const int SOIL_MOISTURE_THRESHOLD_PCT = 55;</code></pre></div><div class="command-card p-4 border rounded-lg"><h3 class="font-bold">setup()</h3><p class="text-sm text-gray-600">Wird einmal beim Start des Arduinos ausgef√ºhrt. Initialisiert Pins, Sensoren etc.</p></div><div class="command-card p-4 border rounded-lg"><h3 class="font-bold">loop()</h3><p class="text-sm text-gray-600">Das Herz des Programms. L√§uft unendlich oft und reagiert dank `millis()` sofort auf GUI-Befehle.</p></div><div class="command-card p-4 border rounded-lg"><h3 class="font-bold">runAutoControl()</h3><p class="text-sm text-gray-600">Hier sind alle Regeln f√ºr den AUTO-Modus definiert.</p></div><div class="command-card p-4 border rounded-lg"><h3 class="font-bold">setAktor()</h3><p class="text-sm text-gray-600">Setzt einen digitalen Pin auf HIGH/LOW, um ein Relais zu schalten.</p></div></div></details>
                        <details class="border-t pt-4"><summary class="text-xl font-bold">Python GUI Code-Referenz (.py)</summary><div id="python-commands" class="mt-4 space-y-4"><div class="command-card p-4 border rounded-lg"><h3 class="font-bold">find_arduino()</h3><p class="text-sm text-gray-600">Sucht beim Start nach einem angeschlossenen Arduino.</p></div><div class="command-card p-4 border rounded-lg"><h3 class="font-bold">class GreenhouseGUI</h3><p class="text-sm text-gray-600">Die Hauptklasse f√ºr das gesamte GUI-Fenster.</p></div><div class="command-card p-4 border rounded-lg"><h3 class="font-bold">setup_ui()</h3><p class="text-sm text-gray-600">Baut die gesamte grafische Oberfl√§che zusammen.</p></div><div class="command-card p-4 border rounded-lg"><h3 class="font-bold">update_data()</h3><p class="text-sm text-gray-600">Liest periodisch JSON-Daten vom Arduino und aktualisiert die GUI.</p></div><div class="command-card p-4 border rounded-lg"><h3 class="font-bold">send_command_to_arduino()</h3><p class="text-sm text-gray-600">Formatiert Befehle in JSON und sendet sie an den Arduino.</p></div><div class="command-card p-4 border rounded-lg"><h3 class="font-bold">callGardenerAI()</h3><p class="text-sm text-gray-600">Formuliert den System-Prompt und sendet die Anfrage an die Gemini API.</p></div></div></details>
                    </div>
                </div>
            </section>
        </main>
        
        <footer class="mt-16 pt-8 border-t text-center text-sm text-gray-500">
            <p><strong>Ein Projekt der Gruppe EIS23</strong></p>
            <p>Nico Loske, Jonas Pleis, Malte Fle√üner</p>
            <p class="mt-4">Smart Greenhouse | Benutzerhandbuch (Entwickler-Edition)</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const ctx = document.getElementById('growthPhaseChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Vegetativ', 'Bl√ºte', 'Frucht'],
                    datasets: [
                        { label: 'Max Temp Tag (¬∞C)', data: [26, 24, 25], backgroundColor: '#FF6B6B' },
                        { label: 'Max Temp Nacht (¬∞C)', data: [22, 18, 15], backgroundColor: '#FED766' },
                        { label: 'Max Luftf. Tag (%)', data: [80, 70, 65], backgroundColor: '#4ECDC4' },
                        { label: 'Max Luftf. Nacht (%)', data: [90, 80, 75], backgroundColor: '#45B7D1' }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } }, plugins: { legend: { position: 'bottom' }, title: { display: true, text: 'Zielwerte der Wachstumsphasen' } } }
            });

            const searchInput = document.getElementById('commandSearch');
            const commandCards = document.querySelectorAll('.command-card');
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                commandCards.forEach(card => {
                    const cardText = card.textContent.toLowerCase();
                    if (cardText.includes(searchTerm)) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
            
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const chatButton = document.getElementById('ask-button');
            const chatInput = document.getElementById('plant-question');
            const chatContainer = document.getElementById('chat-container');
            const chatLoader = document.getElementById('chat-loader');
            const chatResult = document.getElementById('chat-result');

            async function callGardenerAI(userQuestion) {
                chatButton.disabled = true;
                chatInput.disabled = true;
                chatContainer.classList.remove('hidden');
                chatLoader.classList.remove('hidden');
                chatResult.innerHTML = '';

                const systemPrompt = `Du bist ein Experte f√ºr den Anbau von Pflanzen, G√§rtnerei und Botanik. Deine Aufgabe ist es, Fragen zu diesen Themen detailliert, hilfreich und f√ºr Anf√§nger verst√§ndlich zu beantworten. Gib Ratschl√§ge f√ºr die besten Ergebnisse (z.B. f√ºr Geschmack, Gr√∂√üe, Ertrag). Formatiere deine Antworten mit **Fettdruck** f√ºr wichtige Begriffe und nutze Abs√§tze zur besseren Lesbarkeit.
                WICHTIG: Antworte ausschlie√ülich auf Fragen, die sich auf Pflanzen, Gartenarbeit, Botanik oder verwandte Themen beziehen. Wenn eine Frage nichts damit zu tun hat (z.B. nach dem Wetter, Rezepten, Geschichte fragt), lehne die Antwort h√∂flich ab und erkl√§re, dass du nur f√ºr Pflanzenthemen zust√§ndig bist.`;

                try {
                    const payload = { contents: [{ parts: [{ text: userQuestion }] }], systemInstruction: { parts: [{ text: systemPrompt }] } };
                    const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (!response.ok) { throw new Error(`API error: ${response.statusText}`); }
                    const result = await response.json();
                    const text = result.candidates[0].content.parts[0].text;
                    const userHtml = `<div class="font-semibold text-gray-600">Ihre Frage:</div><p class="text-gray-800">${userQuestion}</p>`;
                    const aiHtml = `<div class="font-semibold text-blue-600 mt-4">Antwort des Experten:</div><p class="text-blue-800">${text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>')}</p>`;
                    chatResult.innerHTML = userHtml + aiHtml;
                } catch (error) {
                    chatResult.innerHTML = '<p>Ein Fehler ist aufgetreten. Bitte versuchen Sie es sp√§ter erneut.</p>';
                    console.error("Gemini API Error:", error);
                } finally {
                    chatButton.disabled = false;
                    chatInput.disabled = false;
                    chatLoader.classList.add('hidden');
                }
            }
            
            chatButton.addEventListener('click', () => {
                const question = chatInput.value.trim();
                if (question) { callGardenerAI(question); }
            });
             chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') { chatButton.click(); }
            });
        });
    </script>
</body>
</html>


